<% if (books && books.length> 0) { %>
    <div class="books-grid">
        <% books.forEach(book=> { %>
            <div class="book-card">
                <div class="book-cover">
                    <%= book.title.charAt(0).toUpperCase() %>
                </div>
                <div class="book-info">
                    <h3 class="book-title">
                        <%= book.title %>
                    </h3>
                    <div class="book-author">
                        by <%= book.authors && book.authors.length> 0 ? book.authors.map(author =>
                            `${author.firstName} ${author.lastName}`).join(', ') : 'Unknown Author' %>
                    </div>

                    <div class="book-details">
                        <div class="book-price">
                            <% if (book.price) { %>
                                $<%= book.price.toFixed(2) %>
                                    <% } else { %>
                                        Price not available
                                        <% } %>
                        </div>
                        <% if (book.reviews && book.reviews.length> 0) { %>
                            <div class="book-rating">
                                <span class="stars">
                                    <% const avgRating=book.reviews.reduce((sum, review)=> sum + review.rate, 0)
                                        / book.reviews.length; %>
                                        <% for (let i=1; i <=5; i++) { %>
                                            <% if (i <=Math.floor(avgRating)) { %>â˜…<% } else if (i - 0.5 <=avgRating) {
                                                    %>â˜†<% } else { %>â˜†<% } %>
                                                            <% } %>
                                </span>
                                <span>(<%= book.reviews.length %>)</span>
                            </div>
                            <% } %>
                    </div>

                    <% if (book.description) { %>
                        <p class="book-description">
                            <%= book.description %>
                        </p>
                        <% } %>

                            <div class="book-meta">
                                <% if (book.publisher) { %>
                                    <span>ðŸ“– <%= book.publisher %></span>
                                    <% } %>
                                        <% if (book.publishedDate) { %>
                                            <span>ðŸ“… <%= new Date(book.publishedDate).getFullYear() %></span>
                                            <% } %>
                            </div>

                            <% if (book.pages) { %>
                                <div class="book-meta">
                                    <span>ðŸ“„ <%= book.pages %> pages</span>
                                    <% if (book.reviews && book.reviews.length> 0) { %>
                                        <span class="book-reviews">ðŸ’¬ <%= book.reviews.length %> review<%=
                                                    book.reviews.length> 1 ? 's' : '' %></span>
                                        <% } %>
                                </div>
                                <% } %>

                                    <a href="/books/<%= book._id %>" class="view-details">View Details</a>
                </div>
            </div>
            <% }); %>
    </div>
    <% } else { %>
        <div class="no-books">
            <h2>No books found</h2>
            <p>The library seems to be empty. Try seeding the database first!</p>
        </div>
        <% } %>